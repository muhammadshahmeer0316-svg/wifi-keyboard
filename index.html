<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Keyboard - Type on Laptop from Mobile</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.2/peerjs.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Simple SVG icons
        const WifiIcon = () => (
            <svg className="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
            </svg>
        );

        const SmartphoneIcon = () => (
            <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
        );

        const LaptopIcon = () => (
            <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
        );

        const CopyIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        );

        const CheckIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
        );

        const AlertIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        );

        function WirelessKeyboard() {
          const [mode, setMode] = useState('select');
          const [peerId, setPeerId] = useState('');
          const [remotePeerId, setRemotePeerId] = useState('');
          const [connection, setConnection] = useState(null);
          const [isConnected, setIsConnected] = useState(false);
          const [receivedText, setReceivedText] = useState('');
          const [mobileInput, setMobileInput] = useState('');
          const [copied, setCopied] = useState(false);
          const [status, setStatus] = useState('Initializing...');
          const [error, setError] = useState('');
          const [connecting, setConnecting] = useState(false);
          const peerRef = useRef(null);
          const textAreaRef = useRef(null);

          useEffect(() => {
            if (mode !== 'select' && window.Peer) {
              initializePeer();
            }
            return () => {
              if (peerRef.current) {
                peerRef.current.destroy();
              }
            };
          }, [mode]);

          const initializePeer = () => {
            try {
              setStatus('Connecting to server...');
              const peer = new window.Peer({
                debug: 2,
                config: {
                  iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:global.stun.twilio.com:3478' }
                  ]
                }
              });
              
              peer.on('open', (id) => {
                setPeerId(id);
                peerRef.current = peer;
                setStatus('Ready');
                setError('');
                console.log('My peer ID is: ' + id);
              });

              peer.on('connection', (conn) => {
                console.log('Incoming connection from:', conn.peer);
                setupConnection(conn);
              });

              peer.on('error', (err) => {
                console.error('Peer error:', err);
                setError(`Connection error: ${err.type}`);
                setStatus('Error');
              });

              peer.on('disconnected', () => {
                console.log('Peer disconnected');
                setStatus('Disconnected - Reconnecting...');
                peer.reconnect();
              });
            } catch (err) {
              console.error('Failed to initialize peer:', err);
              setError('Failed to start. Please refresh the page.');
              setStatus('Error');
            }
          };

          const setupConnection = (conn) => {
            setConnection(conn);
            setConnecting(true);
            
            conn.on('open', () => {
              setIsConnected(true);
              setConnecting(false);
              setError('');
              setStatus('Connected');
              console.log('Connection established!');
            });

            conn.on('data', (data) => {
              console.log('Received:', data);
              if (mode === 'desktop') {
                setReceivedText(prev => prev + data);
                if (textAreaRef.current) {
                  textAreaRef.current.focus();
                }
              }
            });

            conn.on('close', () => {
              console.log('Connection closed');
              setIsConnected(false);
              setConnection(null);
              setStatus('Disconnected');
            });

            conn.on('error', (err) => {
              console.error('Connection error:', err);
              setError('Connection failed: ' + err);
              setConnecting(false);
            });
          };

          const connectToPeer = () => {
            if (!peerRef.current) {
              setError('Not initialized. Please refresh the page.');
              return;
            }
            
            if (!remotePeerId) {
              setError('Please enter a Device ID');
              return;
            }

            try {
              setConnecting(true);
              setError('');
              setStatus('Connecting...');
              console.log('Attempting to connect to:', remotePeerId);
              
              const conn = peerRef.current.connect(remotePeerId, {
                reliable: true
              });
              
              setupConnection(conn);

              // Timeout after 15 seconds
              setTimeout(() => {
                if (!isConnected && connecting) {
                  setConnecting(false);
                  setError('Connection timeout. Check the Device ID and try again.');
                  setStatus('Ready');
                }
              }, 15000);
            } catch (err) {
              console.error('Connection error:', err);
              setError('Failed to connect: ' + err.message);
              setConnecting(false);
              setStatus('Ready');
            }
          };

          const sendText = (text) => {
            if (connection && isConnected) {
              try {
                connection.send(text);
                console.log('Sent:', text);
              } catch (err) {
                console.error('Failed to send:', err);
                setError('Failed to send text');
              }
            }
          };

          const handleMobileInput = (e) => {
            const newChar = e.target.value.slice(-1);
            if (newChar) {
              sendText(newChar);
            }
            setMobileInput(e.target.value);
          };

          const handleKeyPress = (key) => {
            sendText(key);
            setMobileInput(prev => prev + key);
          };

          const copyToClipboard = () => {
            navigator.clipboard.writeText(peerId);
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          };

          const clearText = () => {
            setReceivedText('');
          };

          if (mode === 'select') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                <div className="max-w-md w-full">
                  <div className="text-center mb-8">
                    <div className="mx-auto mb-4 text-indigo-600">
                      <WifiIcon />
                    </div>
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">WiFi Keyboard</h1>
                    <p className="text-gray-600">Type on your laptop using your mobile</p>
                  </div>
                  
                  <div className="space-y-4">
                    <button
                      onClick={() => setMode('mobile')}
                      className="w-full bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow border-2 border-transparent hover:border-indigo-300"
                    >
                      <div className="mx-auto mb-3 text-indigo-600">
                        <SmartphoneIcon />
                      </div>
                      <h2 className="text-xl font-semibold text-gray-800 mb-2">Mobile Device</h2>
                      <p className="text-gray-600 text-sm">Use this device as a keyboard</p>
                    </button>

                    <button
                      onClick={() => setMode('desktop')}
                      className="w-full bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow border-2 border-transparent hover:border-indigo-300"
                    >
                      <div className="mx-auto mb-3 text-indigo-600">
                        <LaptopIcon />
                      </div>
                      <h2 className="text-xl font-semibold text-gray-800 mb-2">Laptop/Desktop</h2>
                      <p className="text-gray-600 text-sm">Receive input from mobile</p>
                    </button>
                  </div>

                  <div className="mt-6 text-center text-sm text-gray-500">
                    <p>Both devices must be on the same WiFi network</p>
                  </div>
                </div>
              </div>
            );
          }

          if (mode === 'mobile') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 p-4">
                <div className="max-w-md mx-auto">
                  <div className="bg-white rounded-xl shadow-lg p-6 mb-4">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-2xl font-bold text-gray-800">Mobile Keyboard</h2>
                      <button onClick={() => setMode('select')} className="text-sm text-indigo-600">
                        Change Mode
                      </button>
                    </div>

                    {/* Status Badge */}
                    <div className={`mb-4 px-3 py-2 rounded-lg text-sm font-medium ${
                      status === 'Ready' ? 'bg-green-100 text-green-800' :
                      status === 'Connected' ? 'bg-blue-100 text-blue-800' :
                      status === 'Error' ? 'bg-red-100 text-red-800' :
                      'bg-yellow-100 text-yellow-800'
                    }`}>
                      Status: {status}
                    </div>

                    {error && (
                      <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex gap-2">
                        <AlertIcon />
                        <p className="text-sm text-red-800">{error}</p>
                      </div>
                    )}

                    {!isConnected ? (
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Your Device ID
                          </label>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={peerId}
                              readOnly
                              className="flex-1 px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm"
                              placeholder="Generating ID..."
                            />
                            <button
                              onClick={copyToClipboard}
                              disabled={!peerId}
                              className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300"
                            >
                              {copied ? <CheckIcon /> : <CopyIcon />}
                            </button>
                          </div>
                          <p className="text-xs text-gray-500 mt-1">Share this ID with your laptop</p>
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Laptop Device ID
                          </label>
                          <input
                            type="text"
                            value={remotePeerId}
                            onChange={(e) => setRemotePeerId(e.target.value)}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                            placeholder="Paste laptop ID here"
                          />
                        </div>

                        <button
                          onClick={connectToPeer}
                          disabled={!remotePeerId || connecting || !peerId}
                          className="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
                        >
                          {connecting ? 'Connecting...' : 'Connect'}
                        </button>
                      </div>
                    ) : (
                      <div className="text-center py-4">
                        <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                          <CheckIcon />
                        </div>
                        <p className="text-green-600 font-semibold">Connected to Laptop</p>
                        <p className="text-sm text-gray-500 mt-1">Start typing below</p>
                      </div>
                    )}
                  </div>

                  {isConnected && (
                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <textarea
                        value={mobileInput}
                        onChange={handleMobileInput}
                        className="w-full h-40 px-4 py-3 border border-gray-300 rounded-lg resize-none text-lg"
                        placeholder="Type here... Text will appear on laptop"
                        autoFocus
                      />
                      
                      <div className="grid grid-cols-4 gap-2 mt-4">
                        {['⌫', '↵', '␣', '⇥'].map((key, i) => (
                          <button
                            key={i}
                            onClick={() => handleKeyPress(key === '␣' ? ' ' : key === '↵' ? '\n' : key === '⇥' ? '\t' : '\b')}
                            className="py-3 bg-gray-100 rounded-lg font-semibold hover:bg-gray-200 text-xl"
                          >
                            {key}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          if (mode === 'desktop') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-50 to-teal-100 p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-xl shadow-lg p-6 mb-4">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-2xl font-bold text-gray-800">Laptop Receiver</h2>
                      <button onClick={() => setMode('select')} className="text-sm text-indigo-600">
                        Change Mode
                      </button>
                    </div>

                    {/* Status Badge */}
                    <div className={`mb-4 px-3 py-2 rounded-lg text-sm font-medium ${
                      status === 'Ready' ? 'bg-green-100 text-green-800' :
                      status === 'Connected' ? 'bg-blue-100 text-blue-800' :
                      status === 'Error' ? 'bg-red-100 text-red-800' :
                      'bg-yellow-100 text-yellow-800'
                    }`}>
                      Status: {status}
                    </div>

                    {error && (
                      <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex gap-2">
                        <AlertIcon />
                        <p className="text-sm text-red-800">{error}</p>
                      </div>
                    )}

                    {!isConnected ? (
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Your Device ID
                          </label>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={peerId}
                              readOnly
                              className="flex-1 px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
                              placeholder="Generating ID..."
                            />
                            <button
                              onClick={copyToClipboard}
                              disabled={!peerId}
                              className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300"
                            >
                              {copied ? <CheckIcon /> : <CopyIcon />}
                            </button>
                          </div>
                          <p className="text-xs text-gray-500 mt-1">Share this ID with your mobile device</p>
                        </div>

                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                          <p className="text-sm text-blue-800">
                            <strong>Waiting for connection...</strong> Enter this ID on your mobile device to connect.
                          </p>
                        </div>
                      </div>
                    ) : (
                      <div className="text-center py-4">
                        <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                          <CheckIcon />
                        </div>
                        <p className="text-green-600 font-semibold">Connected to Mobile</p>
                      </div>
                    )}
                  </div>

                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold text-gray-800">Received Text</h3>
                      <button
                        onClick={clearText}
                        className="px-4 py-2 text-sm bg-red-100 text-red-600 rounded-lg hover:bg-red-200"
                      >
                        Clear
                      </button>
                    </div>
                    <textarea
                      ref={textAreaRef}
                      value={receivedText}
                      onChange={(e) => setReceivedText(e.target.value)}
                      className="w-full h-96 px-4 py-3 border border-gray-300 rounded-lg resize-none text-lg font-mono"
                      placeholder="Text from mobile will appear here..."
                    />
                  </div>
                </div>
              </div>
            );
          }
        }

        ReactDOM.render(<WirelessKeyboard />, document.getElementById('root'));
    </script>
</body>
</html>
